<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
    <style>
        body {
            font-family: Arial;
        }

        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            /*padding: 6px 12px;*/
            border: 1px solid #ccc;
            border-top: none;
        }

      

        table,
        td,
        th {
            font-size: 13px;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }
    </style>
</head>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>

<body>

     <div class="tab">
        <button class="tablinks" onclick="open_tab(event, 'tab_open_orders')">Open Orders</button>
        <button class="tablinks" onclick="open_tab(event, 'tab_today_orders')">Today Orders</button>
        <button class="tablinks" onclick="open_tab(event, 'tab_nomiving_orders')">No Miving Orders</button>
        <button class="tablinks" onclick="open_tab(event, 'tab_transit_orders')">In Transit Orders</button>
        <button class="tablinks" onclick="open_tab(event, 'tab_history_orders')"> Search Orders</button>

    </div>

    <div id="tab_open_orders" class="tabcontent">

        <div id="contain_open_orders"></div>
    </div>

    <div id="tab_today_orders" class="tabcontent">
        <div id="contain_today_orders"></div>
    </div>

    <div id="tab_nomiving_orders" class="tabcontent">
        <div id="contain_nomiving_orders"></div>
    </div>
    <div id="tab_transit_orders" class="tabcontent">
        <div id="contain_transit_orders"></div>
    </div>
    <div id="tab_history_orders" class="tabcontent">
        <div style="float:left; ">
            ShipDate: <input type="text" onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'datemax\')||\'%y-%M-%d\'}' })" id="datemin" class="input-text Wdate" style="width:120px;">
            -
            <input type="text" onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'datemin\')}',maxDate:'%y-%M-%d' })" id="datemax" class="input-text Wdate" style="width:120px;">

            <button type="submit" class="btn btn-success" id="Search_Orders_by_date" name=""><i class="icon-search"></i> Search</button>
        </div>
        <div style="float:left; margin-left: 5%;">
            TrackingNumber: <input type="text" name="lname" id='trackingNumber'>
            <button type="submit" class="btn btn-success" id="Search_Orders_by_TrackingNumber" name=""><i class="icon-search"></i> Search</button>
			
        </div>
		
		<div style="float:left; margin-left: 5%;">
		 OrderID: <input type="text" name="lname" id='TxnId' >
		<button type="submit" class="btn btn-success" id="Search_Orders_by_TxnId" name=""><i class="icon-search"></i> Search</button>
		</div>
       
		
        <div id="contain_history_orders"></div>
    </div>

    <script>
        setdate();

        function open_tab(evt, tabName) {
            if (tabName == 'tab_open_orders') {
                getNoShippedOrders();
            } else if (tabName == 'tab_today_orders') {
                getTodayOrders('contain_today_orders', 'today_orders');
            } else if (tabName == 'tab_nomiving_orders') {
                getnomiving_orders('contain_nomiving_orders', 'nomiving_orders');
            } else if (tabName == 'tab_transit_orders') {
                gettransit_orders('contain_transit_orders', 'transit_orders');
            } else if (tabName == 'tab_history_orders') {
                //get_orders_by_date('contain_history_orders', 'history_orders');
            }
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            $("#" + tabName).css("display", "block");
            // document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        var height = $(window).height();
        var setHeigth = ($(window).height() - 150);
        $(document).ready(function() {

            getNoShippedOrders();
            $("#tab_open_orders").css("display", "block");
           // $("#tab_today_orders").css("display", "block");
           // $("#tab_nomiving_orders").css("display", "block");
           // $("#tab_transit_orders").css("display", "block");
           // $("#tab_history_orders").css("display", "block");



            $("#Search_Orders_by_date").click(function() {

                get_orders_by_date('contain_history_orders', 'history_orders');
            });
            $("#Search_Orders_by_TrackingNumber").click(function() {

                get_Orders_by_TrakingNumber('contain_history_orders', 'history_orders');
            });
			$("#Search_Orders_by_TxnId").click(function() {

                get_Orders_by_TxnId('contain_history_orders', 'history_orders');
            });

        });


        function getNoShippedOrders() {
            loadingLayer();
            $.ajax({
                url: 'notshipped_orders.php',
                type: 'post',

                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var T_UpdateTime = listArr[0].T_UpdateTime;
                    var newArr = formatData_NoShipped(listArr);
                   
                    displayOpenOrdersToTable(newArr);
					 layer.close(layerIndex);
                  //  getTodayOrders('contain_today_orders', 'today_orders');



                }
            });


        }

        function formatData_NoShipped(data) {
            var displayArr = [];
            var officeScanedNum = 0;
            var warehouseScanedNum = 0;

            for (var i in data) {
                var TempObj = {};
                var TxnId = data[i].TxnId;
                var StoreType = data[i].StoreType;
                var PaymentDate = data[i].PaymentDate;
                var PaymentStatus = data[i].PaymentStatus;
                var OrderItems = jQuery.parseJSON(data[i].OrderItems);
                var Description = OrderItems[0].Description;
                var Name = OrderItems[0].Name;
                var Quantity = OrderItems[0].Quantity;
                var Amount = OrderItems[0].Amount;
                var Buyer = jQuery.parseJSON(data[i].ToJson);
                var Buyer_Name = Buyer.Name;
                var Buyer_Street = Buyer.Street;
                var Buyer_Street2 = Buyer.Street2;
                var Buyer_State = Buyer.State;
                var Buyer_City = Buyer.City;
                var Buyer_PhoneNumber = Buyer.PhoneNumber;
                var Buyer_Email = Buyer.Email;
                var Buyer_ZipCode = Buyer.ZipCode;
                var Buyer_ZipCode = Buyer.ZipCode;
                var ShipClass = data[i].ShipClass;
                var ShipDate = data[i].ShipDate;
                var ShipMethod = data[i].ShipMethod;
                var TrackingNumber = data[i].TrackingNumber;
                var TrackingStatus = data[i].TrackingStatus;
                var TrackingSummary = data[i].TrackingSummary;
				
                if (ShipClass.indexOf("PRIME") >= 0) {
                    var date = new Date();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (hours >= 15) {
                        var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span>";
                    } else {
                        var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span>";
                    }




                } else {
                    var ShippingHtmlString = ShipClass;
                }


                var OrderHtmlString = TxnId + "<br>" + Description + "<br>" + Name + "<br>" + StoreType;


                var PaymentHtmlString = PaymentDate + "<br>" + Buyer_Email + "<br>" + Amount + " " + PaymentStatus;
                if (Buyer_Street2 != '') {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_Street2 + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                } else

                {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                }
                var isToday = checkItToday(ShipDate);


                TempObj.Order = OrderHtmlString;
                TempObj.Payment = PaymentHtmlString;
                TempObj.Buyer = BuyerHtmlString;
                TempObj.Shipping = ShippingHtmlString;
                TempObj.Tracking = '';
                TempObj.Office = '';
                TempObj.Warehouse = '';
                TempObj.isToday = -1;

                displayArr.push(TempObj);

            }

            return displayArr;


        }


        function getTodayOrders(containId, tableId) {
            loadingLayer();
            $.ajax({
                url: 'TodayOrders.php',
                type: 'post',

                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatData(listArr);
                    displayToTable(newArr, containId, tableId);
                    layer.close(layerIndex);
                    //getnomiving_orders('contain_nomiving_orders', 'nomiving_orders');


                }
            });


        }

        function getnomiving_orders(containId, tableId) {
            loadingLayer();
            $.ajax({
                url: 'NoMovingOrders.php',
                type: 'post',

                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatData(listArr);
                    var newArr2 = removeTodayData(newArr);
                    displayToTable(newArr2, containId, tableId);
                    layer.close(layerIndex);
                    //gettransit_orders('contain_transit_orders', 'transit_orders');


                }
            });


        }

        function removeTodayData(data) {


            for (var i = data.length - 1; i >= 0; i--) {
                var isToday = data[i].isToday;
                if (isToday == 0) {
                    data.splice(i, 1);
                }


            }
            return data;
        }

        function gettransit_orders(containId, tableId) {
            loadingLayer();
            $.ajax({
                url: 'TransitOrders.php',
                type: 'post',

                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatData_Transit(listArr);
                    displayTransitToTable(newArr, containId, tableId);
                    layer.close(layerIndex);
                   // get_orders_by_date('contain_history_orders', 'history_orders');


                }
            });


        }

        function get_orders_by_date(containId, tableId) {
            loadingLayer();
            var startDate = document.getElementById("datemin").value;
            var endDate = document.getElementById("datemax").value;
            $.ajax({
                url: 'HistoryOrders_by_date.php',
                type: 'post',
                data: {
                    "startDate": startDate,
                    "endDate": endDate
                },
                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatDataBysearch(listArr);
                    displayToTable(newArr, containId, tableId);
                    layer.close(layerIndex);

                }
            });


        }

        function get_Orders_by_TrakingNumber(containId, tableId) {
            var trackingNumber = document.getElementById("trackingNumber").value;

            loadingLayer();


            $.ajax({
                url: 'HistoryOrders_by_TrakingNumber.php',
                type: 'post',
                data: {
                    "TrackingNumber": trackingNumber,

                },
                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatDataBysearch(listArr);
                    displayToTable(newArr, containId, tableId);

                    layer.close(layerIndex);
                }
            });


        } 
		function get_Orders_by_TxnId(containId, tableId) {
            var TxnId = document.getElementById("TxnId").value;

            loadingLayer();


            $.ajax({
                url: 'HistoryOrders_by_TxnId.php',
                type: 'post',
                data: {
                    "TxnId": TxnId,

                },
                success: function(output) {
                    listArr = jQuery.parseJSON(output);
                    var newArr = formatDataBysearch(listArr);
                    displayToTable(newArr, containId, tableId);

                    layer.close(layerIndex);
                }
            });


        }

        function formatData(data) {
            var displayArr = [];
            var officeScanedNum = 0;
            var officeUnScanedNum = 0;
            var officeTodayUnScanedNum = 0;
            var warehouseScanedNum = 0;
            var warehouseUnScanedNum = 0;
            var warehouseTodayUnScanedNum = 0;
            var todayUnScanedNum = 0;
            var NoMovingOrderNum = 0;
            for (var i in data) {
                var TempObj = {};
                var TxnId = data[i].TxnId;
                var StoreType = data[i].StoreType;
                var PaymentDate = data[i].PaymentDate;
                var PaymentStatus = data[i].PaymentStatus;
                var OrderItems = jQuery.parseJSON(data[i].OrderItems);
                var Description = OrderItems[0].Description;
                var Name = OrderItems[0].Name;
                var Quantity = OrderItems[0].Quantity;
                var Amount = OrderItems[0].Amount;
                var Buyer = jQuery.parseJSON(data[i].ToJson);
                var Buyer_Name = Buyer.Name;
                var Buyer_Street = Buyer.Street;
                var Buyer_Street2 = Buyer.Street2;
                var Buyer_State = Buyer.State;
                var Buyer_City = Buyer.City;
                var Buyer_PhoneNumber = Buyer.PhoneNumber;
                var Buyer_Email = Buyer.Email;
                var Buyer_ZipCode = Buyer.ZipCode;
                var Buyer_ZipCode = Buyer.ZipCode;
                var ShipClass = data[i].ShipClass;
                var ShipDate = data[i].ShipDate;
                var ShipMethod = data[i].ShipMethod;
                var TrackingNumber = data[i].TrackingNumber;
                var TrackingStatus = data[i].TrackingStatus;
                var TrackingSummary = data[i].TrackingSummary;
				 var UpdateTime = data[i].UpdateTime;
				  var Memo = data[i].Memo;
                if (ShipMethod !== undefined) {
                    var ShipMethod2 = ShipMethod.toLowerCase();
                    if (ShipMethod2.indexOf("usps") >= 0) {
                        TrackingNumber = "<a href='https://tools.usps.com/go/TrackConfirmAction?tLabels=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else if (ShipMethod2.indexOf("fedex") >= 0) {
                        TrackingNumber = "<a href='https://www.fedex.com/apps/fedextrack/?action=track&tracknumbers=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else {
                        TrackingNumber = '';
                    }

                    if (ShipClass.indexOf("PRIME") >= 0) {
                        var date = new Date();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours >= 15) {
                            var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span>";
                        } else {
                            var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span>";
                        }




                    } else {
                        var ShippingHtmlString = ShipClass;
                    }

                } else {
                    var ShippingHtmlString = ShipClass;
                }
                if (TrackingNumber == '') {
                    var TrackingHtmlString = "<span style='background-color:red;color:white'>No Tracking Number</span>";
                } else {
                    if (TrackingStatus == '') {
                        var TrackingHtmlString = TrackingNumber + "<br><span style='background-color:#CB33FF ;color:white'>Not Update Yet</span>";
                        //var TrackingHtmlString = TrackingNumber + "<br>The update time will be 10am and 3pm per day.";
                    } else {
                        if (TrackingSummary.indexOf("not in system") >= 0) {
                            var TrackingHtmlString = TrackingNumber + "<br> <span style='background-color:red;color:white'>No Shipping label</span>";
                        } else {
                             var TrackingHtmlString = TrackingNumber + "<br>" + TrackingSummary + "<br>" + UpdateTime+ "<br>" + Memo;
                        }

                    }
                }

                var isToday = checkItToday(ShipDate);
                var isToday2 = calcDate(ShipDate);

                var offficeScanStatus = data[i].offficeScanStatus;
                var offficeScanStatus2 = data[i].offficeScanStatus;


                var warehouseStatus = data[i].warehouseStatus;
                var warehouseStatus2 = data[i].warehouseStatus;
                if (offficeScanStatus == 'true') {
                    officeScanedNum++;
                    offficeScanStatus = 'Scanned';
                    var officeScanTime = data[i].officeScanTime;
                    var offficeScanner = data[i].offficeScanner;
                    var offficeScanHtmlString = offficeScanStatus + "<br>" + offficeScanner + "<br>" + officeScanTime;
                } else {
                    officeUnScanedNum++;
                    offficeScanStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var offficeScanHtmlString = offficeScanStatus;
                    if (isToday2 == 0) {
                        officeTodayUnScanedNum++;
                    }
                }
                if (warehouseStatus == 'true') {
                    warehouseScanedNum++;
                    warehouseStatus = 'Scanned';
                    var warehouseScanTime = data[i].warehouseScanTime;
                    var warehouseScanner = data[i].warehouseScanner;
                    var warehouseScanHtmlString = warehouseStatus + "<br>" + warehouseScanner + "<br>" + warehouseScanTime;
                } else {
                    warehouseUnScanedNum++;
                    warehouseStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var warehouseScanHtmlString = warehouseStatus;
                    if (isToday2 == 0) {
                        warehouseTodayUnScanedNum++;
                    }
                }



                if (ShipClass.indexOf("PRIME") >= 0) {

                    var date = new Date();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (hours >= 15) {
                        var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span><br>" + ShipDate + "<br>" + ShipMethod;
                    } else {
                        var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span><br>" + ShipDate + "<br>" + ShipMethod;
                    }

                } else {
                    var ShippingHtmlString = ShipClass + "<br>" + ShipDate + "<br>" + ShipMethod;
                }


                var OrderHtmlString = TxnId + "<br>" + Description + "<br>" + Name + "<br>" + StoreType;


                var PaymentHtmlString = PaymentDate + "<br>" + Buyer_Email + "<br>" + Amount + " " + PaymentStatus;
                if (Buyer_Street2 != '') {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_Street2 + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                } else

                {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                }

                if (isToday2 == 0) {
				/* todayUnScanedNum++;
                        TempObj.Order = OrderHtmlString;
                        TempObj.Payment = PaymentHtmlString;
                        TempObj.Buyer = BuyerHtmlString;
                        TempObj.Shipping = ShippingHtmlString;
                        TempObj.Tracking = TrackingHtmlString;

                        TempObj.Office = offficeScanHtmlString;
                        TempObj.Warehouse = warehouseScanHtmlString;

                        TempObj.isToday = isToday2;

                        displayArr.push(TempObj);
					*/	
                    if (offficeScanStatus2 == 'true' && warehouseStatus2 == 'true') {


                    } else {
                        todayUnScanedNum++;
                        TempObj.Order = OrderHtmlString;
                        TempObj.Payment = PaymentHtmlString;
                        TempObj.Buyer = BuyerHtmlString;
                        TempObj.Shipping = ShippingHtmlString;
                        TempObj.Tracking = TrackingHtmlString;

                        TempObj.Office = offficeScanHtmlString;
                        TempObj.Warehouse = warehouseScanHtmlString;

                        TempObj.isToday = isToday2;

                        displayArr.push(TempObj);

                    }
                } else if (isToday2 >= 1) {
                    NoMovingOrderNum++;
                    TempObj.Order = OrderHtmlString;
                    TempObj.Payment = PaymentHtmlString;
                    TempObj.Buyer = BuyerHtmlString;
                    TempObj.Shipping = ShippingHtmlString;
                    TempObj.Tracking = TrackingHtmlString;

                    TempObj.Office = offficeScanHtmlString;
                    TempObj.Warehouse = warehouseScanHtmlString;

                    TempObj.isToday = isToday2;

                    displayArr.push(TempObj);

                }
            }

            $("#spOSNum").text(officeUnScanedNum);
            $("#spWSNum").text(warehouseUnScanedNum);
            $("#spTodayOSNum").text(officeTodayUnScanedNum);
            $("#spTodayWSNum").text(warehouseTodayUnScanedNum);
            $("#spTodayTotalNum").text(todayUnScanedNum);
            $("#spnmNum").text(NoMovingOrderNum);


            return displayArr;

        }
		function formatDataBysearch(data) {
            var displayArr = [];
            var officeScanedNum = 0;
            var officeUnScanedNum = 0;
            var officeTodayUnScanedNum = 0;
            var warehouseScanedNum = 0;
            var warehouseUnScanedNum = 0;
            var warehouseTodayUnScanedNum = 0;
            var todayUnScanedNum = 0;
            var NoMovingOrderNum = 0;
            for (var i in data) {
                var TempObj = {};
                var TxnId = data[i].TxnId;
                var StoreType = data[i].StoreType;
                var PaymentDate = data[i].PaymentDate;
                var PaymentStatus = data[i].PaymentStatus;
                var OrderItems = jQuery.parseJSON(data[i].OrderItems);
                var Description = OrderItems[0].Description;
                var Name = OrderItems[0].Name;
                var Quantity = OrderItems[0].Quantity;
                var Amount = OrderItems[0].Amount;
                var Buyer = jQuery.parseJSON(data[i].ToJson);
                var Buyer_Name = Buyer.Name;
                var Buyer_Street = Buyer.Street;
                var Buyer_Street2 = Buyer.Street2;
                var Buyer_State = Buyer.State;
                var Buyer_City = Buyer.City;
                var Buyer_PhoneNumber = Buyer.PhoneNumber;
                var Buyer_Email = Buyer.Email;
                var Buyer_ZipCode = Buyer.ZipCode;
                var Buyer_ZipCode = Buyer.ZipCode;
                var ShipClass = data[i].ShipClass;
                var ShipDate = data[i].ShipDate;
                var ShipMethod = data[i].ShipMethod;
                var TrackingNumber = data[i].TrackingNumber;
                var TrackingStatus = data[i].TrackingStatus;
                var TrackingSummary = data[i].TrackingSummary;
				 var UpdateTime = data[i].UpdateTime;
				  var Memo = data[i].Memo;
                if (ShipMethod !== undefined) {
                    var ShipMethod2 = ShipMethod.toLowerCase();
                    if (ShipMethod2.indexOf("usps") >= 0) {
                        TrackingNumber = "<a href='https://tools.usps.com/go/TrackConfirmAction?tLabels=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else if (ShipMethod2.indexOf("fedex") >= 0) {
                        TrackingNumber = "<a href='https://www.fedex.com/apps/fedextrack/?action=track&tracknumbers=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else {
                        TrackingNumber = '';
                    }

                    if (ShipClass.indexOf("PRIME") >= 0) {
                        var date = new Date();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours >= 15) {
                            var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span>";
                        } else {
                            var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span>";
                        }




                    } else {
                        var ShippingHtmlString = ShipClass;
                    }

                } else {
                    var ShippingHtmlString = ShipClass;
                }
                if (TrackingNumber == '') {
                    var TrackingHtmlString = "<span style='background-color:red;color:white'>No Tracking Number</span>";
                } else {
                    if (TrackingStatus == '') {
                        var TrackingHtmlString = TrackingNumber + "<br><span style='background-color:#CB33FF ;color:white'>Not Update Yet</span>";
                        //var TrackingHtmlString = TrackingNumber + "<br>The update time will be 10am and 3pm per day.";
                    } else {
                        if (TrackingSummary.indexOf("not in system") >= 0) {
                            var TrackingHtmlString = TrackingNumber + "<br> <span style='background-color:red;color:white'>No Shipping label</span>";
                        } else {
                             var TrackingHtmlString = TrackingNumber + "<br>" + TrackingSummary + "<br>" + UpdateTime+ "<br>" + Memo;
                        }

                    }
                }

                var isToday = checkItToday(ShipDate);
                var isToday2 = calcDate(ShipDate);

                var offficeScanStatus = data[i].offficeScanStatus;
                var offficeScanStatus2 = data[i].offficeScanStatus;


                var warehouseStatus = data[i].warehouseStatus;
                var warehouseStatus2 = data[i].warehouseStatus;
                if (offficeScanStatus == 'true') {
                    officeScanedNum++;
                    offficeScanStatus = 'Scanned';
                    var officeScanTime = data[i].officeScanTime;
                    var offficeScanner = data[i].offficeScanner;
                    var offficeScanHtmlString = offficeScanStatus + "<br>" + offficeScanner + "<br>" + officeScanTime;
                } else {
                    officeUnScanedNum++;
                    offficeScanStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var offficeScanHtmlString = offficeScanStatus;
                    if (isToday2 == 0) {
                        officeTodayUnScanedNum++;
                    }
                }
                if (warehouseStatus == 'true') {
                    warehouseScanedNum++;
                    warehouseStatus = 'Scanned';
                    var warehouseScanTime = data[i].warehouseScanTime;
                    var warehouseScanner = data[i].warehouseScanner;
                    var warehouseScanHtmlString = warehouseStatus + "<br>" + warehouseScanner + "<br>" + warehouseScanTime;
                } else {
                    warehouseUnScanedNum++;
                    warehouseStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var warehouseScanHtmlString = warehouseStatus;
                    if (isToday2 == 0) {
                        warehouseTodayUnScanedNum++;
                    }
                }



                if (ShipClass.indexOf("PRIME") >= 0) {

                    var date = new Date();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (hours >= 15) {
                        var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span><br>" + ShipDate + "<br>" + ShipMethod;
                    } else {
                        var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span><br>" + ShipDate + "<br>" + ShipMethod;
                    }

                } else {
                    var ShippingHtmlString = ShipClass + "<br>" + ShipDate + "<br>" + ShipMethod;
                }


                var OrderHtmlString = TxnId + "<br>" + Description + "<br>" + Name + "<br>" + StoreType;


                var PaymentHtmlString = PaymentDate + "<br>" + Buyer_Email + "<br>" + Amount + " " + PaymentStatus;
                if (Buyer_Street2 != '') {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_Street2 + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                } else

                {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                }

                if (isToday2 == 0) {
					todayUnScanedNum++;
                        TempObj.Order = OrderHtmlString;
                        TempObj.Payment = PaymentHtmlString;
                        TempObj.Buyer = BuyerHtmlString;
                        TempObj.Shipping = ShippingHtmlString;
                        TempObj.Tracking = TrackingHtmlString;

                        TempObj.Office = offficeScanHtmlString;
                        TempObj.Warehouse = warehouseScanHtmlString;

                        TempObj.isToday = isToday2;

                        displayArr.push(TempObj);
						
                    
                } else if (isToday2 >= 1) {
                    NoMovingOrderNum++;
                    TempObj.Order = OrderHtmlString;
                    TempObj.Payment = PaymentHtmlString;
                    TempObj.Buyer = BuyerHtmlString;
                    TempObj.Shipping = ShippingHtmlString;
                    TempObj.Tracking = TrackingHtmlString;

                    TempObj.Office = offficeScanHtmlString;
                    TempObj.Warehouse = warehouseScanHtmlString;

                    TempObj.isToday = isToday2;

                    displayArr.push(TempObj);

                }
            }

            $("#spOSNum").text(officeUnScanedNum);
            $("#spWSNum").text(warehouseUnScanedNum);
            $("#spTodayOSNum").text(officeTodayUnScanedNum);
            $("#spTodayWSNum").text(warehouseTodayUnScanedNum);
            $("#spTodayTotalNum").text(todayUnScanedNum);
            $("#spnmNum").text(NoMovingOrderNum);


            return displayArr;

        }
        function displayOpenOrdersToTable(data) {
            // loadingLayer();
            $("#contain_open_orders").empty();
            $("#contain_open_orders").append(" <table width='100%' id='mainTable'></table>");


            var table = $('#mainTable').DataTable({
                destroy: true,
                select: true,
                scrollY: setHeigth,
                scrollX: false,
                scrollCollapse: true,
                paging: false,
                autoWidth: false,
                data: data,

                "columns": [{
                        "title": "Order",
                        "data": "Order",
                        "width": 500

                    },
                    {
                        "title": "Payment",
                        "data": "Payment",


                    },

                    {
                        "title": "Buyer",
                        "data": "Buyer",


                    }, {
                        "title": "Shipping",
                        "data": "Shipping",

                    }

                ],



            });


        }

        function displayToTable(data, containId, tableId) {
            // loadingLayer();
            $("#" + containId).empty();
            var str = "<table width='100%' id='" + tableId + "'></table>";
            //var str="<table width='100%' id='tab_today_orders'></table>";
            $("#" + containId).append(str);


            var table = $("#" + tableId).DataTable({
                //var table = $("#tab_today_orders").DataTable({
                destroy: true,
                select: true,
                scrollY: setHeigth,
                scrollX: false,
                scrollCollapse: true,
                paging: false,
                autoWidth: false,
                data: data,

                "columns": [{
                        "title": "Order",
                        "data": "Order",

                    },
                    {
                        "title": "Payment",
                        "data": "Payment",


                    },

                    {
                        "title": "Buyer",
                        "data": "Buyer",


                    }, {
                        "title": "Shipping",
                        "data": "Shipping",

                    }, {
                        "title": "Tracking",
                        "data": "Tracking",

                    }, {
                        "title": "Office",
                        "data": "Office",
                        "width": "150px",

                    },
                    {
                        "title": "Warehouse",
                        "data": "Warehouse",
                        "width": "100px",

                    },
                    {
                        "title": "",
                        "data": "isToday",
                        "width": "70px",
                        "visible": false


                    },

                ],

                "order": [
                    [7, "asc"]
                ],
                "fnRowCallback": function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {


                    if (aData['isToday'] == 0) {

                    } else if (aData['isToday'] == 1) {
                        $('td', nRow).css('background-color', 'Orange');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] == 2) {
                        $('td', nRow).css('background-color', '#E76D6F');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] > 2) {
                        $('td', nRow).css('background-color', 'Red');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] = -1) {
                        $('td', nRow).css('background-color', '#E4E9C9');
                        //$('td', nRow).css('background-color', 'Red');
                    }
                }

            });


        }

        function today() {

            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!

            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            var today = mm + '/' + dd + '/' + yyyy;

            formatAMPM(today)
        }

        function formatAMPM(today) {
            var date = new Date();
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            // $("#spTime").text(today + ' : ' + strTime);
        }
        var layerIndex;

        function loadingLayer() {
            layerIndex = layer.load(1, {
                shade: [0.3, '#fff']
            });

        }

        function checkItToday(ShipDate) {
            var ShipDate = new Date(ShipDate);
            var dd = ShipDate.getDate();
            var mm = ShipDate.getMonth() + 1; //January is 0!

            var yyyy = ShipDate.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            var ShipDate = mm + '/' + dd + '/' + yyyy;
            var today = new Date();

            var today_dd = today.getDate();
            var today_mm = today.getMonth() + 1; //January is 0!

            var today_yyyy = today.getFullYear();
            if (today_dd < 10) {
                today_dd = '0' + dd;
            }
            if (today_mm < 10) {
                today_mm = '0' + today_mm;
            }
            var ShipDate = mm + '/' + dd + '/' + yyyy;
            var today = today_mm + '/' + today_dd + '/' + today_yyyy;
            if (Date.parse(today) == Date.parse(ShipDate)) {
                return true;
            } else {
                return false;
            }

        }




        function calcDate(ShipDate) {
            ShipDate = ShipDate.split(' ')[0];

            var passed = new Date(ShipDate);
            var today = new Date();

            var diff = Math.floor(today.getTime() - passed.getTime());
            var hour = 1000 * 60 * 60;
            var day = 1000 * 60 * 60 * 24;

            var hours = Math.floor(diff / hour);
            var days = Math.floor(diff / day);
            var months = Math.floor(days / 31);
            var years = Math.floor(months / 12);

            /*var message = os_date;
            message += " was "
            message += hours + " hours "
            message += days + " days " 
            message += months + " months "
            message += years + " years ago \n"
            */

            console.log(days);

            return days
        }

        function setdate() {
            var sd = new Date();
            sd.setDate(sd.getDate() - 1);
            var sy = sd.getFullYear();
            var sm = sd.getMonth() + 1;
            var sdd = "01";
            var ed = new Date();
            ed.setDate(ed.getDate());
            var ey = ed.getFullYear();
            var em = ed.getMonth() + 1;
            var edd = ed.getDate();
            if (em >= 1 && em <= 9) {
                em = "0" + em;
            }
            if (edd >= 0 && edd <= 9) {
                edd = "0" + edd;
            }
            $("#datemin").val(sy + "-" + sm + "-" + sdd);
            $("#datemax").val(ey + "-" + em + "-" + edd);
        }
        var layerIndex;

        function loadingLayer() {
            layerIndex = layer.load(1, {
                shade: [0.3, '#fff']
            });

        }
        layer.close(layerIndex);


        function formatData_Transit(data) {
            var displayArr = [];
            var prime_orders1 = 0;
            var prime_orders2 = 0;
            var standard_orders1 = 0;
            var standard_orders2 = 0;

            for (var i in data) {
                var TempObj = {};
                var TxnId = data[i].TxnId;
                var StoreType = data[i].StoreType;

                var PaymentDate = data[i].PaymentDate;
                var PaymentStatus = data[i].PaymentStatus;

                var OrderItems = jQuery.parseJSON(data[i].OrderItems);

                var Description = OrderItems[0].Description;
                var Name = OrderItems[0].Name;


                var Quantity = OrderItems[0].Quantity;
                var Amount = OrderItems[0].Amount;
                var Buyer = jQuery.parseJSON(data[i].ToJson);
                var Buyer_Name = Buyer.Name;
                var Buyer_Street = Buyer.Street;
                var Buyer_Street2 = Buyer.Street2;
                var Buyer_State = Buyer.State;
                var Buyer_City = Buyer.City;
                var Buyer_PhoneNumber = Buyer.PhoneNumber;
                var Buyer_Email = Buyer.Email;
                var Buyer_ZipCode = Buyer.ZipCode;
                var Buyer_ZipCode = Buyer.ZipCode;
                var ShipClass = data[i].ShipClass;
                var ShipDate = data[i].ShipDate;
                var ShipMethod = data[i].ShipMethod;
                var TrackingNumber = data[i].TrackingNumber;
                var TrackingStatus = data[i].TrackingStatus;
                var TrackingSummary = data[i].TrackingSummary;
                var Memo = data[i].Memo;
                var UpdateTime = data[i].UpdateTime;
				 if (ShipMethod !== undefined) {
                    var ShipMethod2 = ShipMethod.toLowerCase();
                    if (ShipMethod2.indexOf("usps") >= 0) {
                        TrackingNumber = "<a href='https://tools.usps.com/go/TrackConfirmAction?tLabels=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else if (ShipMethod2.indexOf("fedex") >= 0) {
                        TrackingNumber = "<a href='https://www.fedex.com/apps/fedextrack/?action=track&tracknumbers=" + TrackingNumber + "' target='_blank'>" + TrackingNumber + "</a>";
                    } else {
                        TrackingNumber = '';
                    }

                    if (ShipClass.indexOf("PRIME") >= 0) {
                        var date = new Date();
                        var hours = date.getHours();
                        var minutes = date.getMinutes();
                        if (hours >= 15) {
                            var ShippingHtmlString = "<span style='background-color:red;color:white'>" + ShipClass + "</span>";
                        } else {
                            var ShippingHtmlString = "<span style='background-color:blue;color:white'>" + ShipClass + "</span>";
                        }




                    } else {
                        var ShippingHtmlString = ShipClass;
                    }

                } else {
                    var ShippingHtmlString = ShipClass;
                }
				

                if (TrackingNumber == '') {
                    var TrackingHtmlString = "<span style='background-color:red;color:white'>No Tracking Number</span>";
                } else {
                    if (TrackingStatus == '') {
                        var TrackingHtmlString = TrackingNumber + "<br><span style='background-color:#CB33FF ;color:white'>Not Update Yet</span>";
                        //var TrackingHtmlString = TrackingNumber + "<br>The update time will be 10am and 3pm per day.";
                    } else {
                        if (TrackingSummary.indexOf("not in system") >= 0) {
                            var TrackingHtmlString = TrackingNumber + "<br> <span style='background-color:red;color:white'>No Shipping label</span>";
                        } else {
                              var TrackingHtmlString = TrackingNumber + "<br>" + TrackingSummary + "<br>" + UpdateTime+ "<br>Note:" + Memo;
                        }

                        /*
                        if(TrackingStatus=='Error')
                        {
                        	var TrackingHtmlString = TrackingNumber + "<br>"+ TrackingSummary;
                        }
                        else
                        {
                        	var TrackingHtmlString = TrackingNumber + "<br>" + TrackingStatus + "<br>" + TrackingSummary;
                        }*/

                    }
                }


                var isToday2 = calcDate(ShipDate);

                var offficeScanStatus = data[i].offficeScanStatus;
                var offficeScanStatus2 = data[i].offficeScanStatus;


                var warehouseStatus = data[i].warehouseStatus;
                var warehouseStatus2 = data[i].warehouseStatus;
                if (offficeScanStatus == 'true') {

                    offficeScanStatus = 'Scanned';
                    var officeScanTime = data[i].officeScanTime;
                    var offficeScanner = data[i].offficeScanner;
                    var offficeScanHtmlString = offficeScanStatus + "<br>" + offficeScanner + "<br>" + officeScanTime;
                } else {

                    offficeScanStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var offficeScanHtmlString = offficeScanStatus;
                    if (isToday2 == 0) {

                    }
                }
                if (warehouseStatus == 'true') {

                    warehouseStatus = 'Scanned';
                    var warehouseScanTime = data[i].warehouseScanTime;
                    var warehouseScanner = data[i].warehouseScanner;
                    var warehouseScanHtmlString = warehouseStatus + "<br>" + warehouseScanner + "<br>" + warehouseScanTime;
                } else {

                    warehouseStatus = "<span style='background-color:red;color:white'>Not Scanned Yet</span>";
                    var warehouseScanHtmlString = warehouseStatus;
                    if (isToday2 == 0) {
                        warehouseTodayUnScanedNum++;
                    }
                }





                var OrderHtmlString = TxnId + "<br>" + Description + "<br>" + Name + "<br>" + StoreType;


                var PaymentHtmlString = PaymentDate + "<br>" + Buyer_Email + "<br>" + Amount + " " + PaymentStatus;
                if (Buyer_Street2 != '') {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_Street2 + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                } else

                {
                    var BuyerHtmlString = Buyer_Name + "<br>" + Buyer_Street + "<br>" + Buyer_State + "<br>" + Buyer_City + Buyer_ZipCode + "<br>" + Buyer_PhoneNumber;
                }


                if (ShipClass.indexOf("PRIME") >= 0) {
                    if (isToday2 > 3) {
                        TempObj.Order = OrderHtmlString;
                        TempObj.Payment = PaymentHtmlString;
                        TempObj.Buyer = BuyerHtmlString;
                        TempObj.Shipping = ShippingHtmlString;
                        TempObj.Tracking = TrackingHtmlString;

                        TempObj.Office = offficeScanHtmlString;
                        TempObj.Warehouse = warehouseScanHtmlString;
                        if (isToday2 == 4) {
                            TempObj.isToday = 1;
                            prime_orders1++;

                        } else if (isToday2 > 4) {
                            TempObj.isToday = 0;
                            prime_orders2++;
                        }


                        displayArr.push(TempObj);




                    } else {

                    }

                } else {
                    if (isToday2 > 6) {
                        TempObj.Order = OrderHtmlString;
                        TempObj.Payment = PaymentHtmlString;
                        TempObj.Buyer = BuyerHtmlString;
                        TempObj.Shipping = ShippingHtmlString;
                        TempObj.Tracking = TrackingHtmlString;

                        TempObj.Office = offficeScanHtmlString;
                        TempObj.Warehouse = warehouseScanHtmlString;
                        if (isToday2 == 7) {
                            TempObj.isToday = 4;
                            standard_orders1++
                        } else if (isToday2 > 7) {
                            TempObj.isToday = 3;
                            standard_orders2++;
                        }
                        TempObj.isToday = isToday2;


                        displayArr.push(TempObj);

                    }
                }



            }
            $("#sppo1").text(prime_orders1);
            $("#sppo2").text(prime_orders2);
            $("#spso1").text(standard_orders1);
            $("#spso2").text(standard_orders2);

            return displayArr;


        }

        function displayTransitToTable(data, containId, tableId) {




            // loadingLayer();
            $("#" + containId).empty();
            var str = "<table width='100%' id='" + tableId + "'></table>";
            //var str="<table width='100%' id='tab_today_orders'></table>";
            $("#" + containId).append(str);


            var table = $('#' + tableId).DataTable({

                destroy: true,
                select: true,
                scrollY: setHeigth,
                scrollX: false,
                scrollCollapse: true,
                paging: false,
                autoWidth: false,
                data: data,
				"columns": [{
                        "title": "Order",
                        "data": "Order",

                    },
                    {
                        "title": "Payment",
                        "data": "Payment",


                    },

                    {
                        "title": "Buyer",
                        "data": "Buyer",


                    }, {
                        "title": "Shipping",
                        "data": "Shipping",

                    }, {
                        "title": "Tracking",
                        "data": "Tracking",

                    }, {
                        "title": "Office",
                        "data": "Office",
                        "width": "150px",

                    },
                    {
                        "title": "Warehouse",
                        "data": "Warehouse",
                        "width": "100px",

                    },
                    {
                        "title": "",
                        "data": "isToday",
                        "width": "70px",
                        "visible": false


                    },

                ],

                "order": [
                    [7, "asc"]
                ],
                "fnRowCallback": function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {


                    if (aData['isToday'] == 0) {
                        $('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] == 1) {
                        $('td', nRow).css('background-color', 'Orange');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] == 3) {
                        $('td', nRow).css('background-color', '#E76D6F');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] > 4) {
                        $('td', nRow).css('background-color', '#E4E9C9');
                        //$('td', nRow).css('background-color', 'Red');
                    } else if (aData['isToday'] = -1) {

                        $('td', nRow).css('background-color', 'green');
                    }
                }




            });


        }
    </script>

</body>

</html>